# HopeJR

## Prerequisites

- [Hardware Setup](https://github.com/TheRobotStudio/HOPEJr)

## Install LeRobot

Follow the [installation instructions](https://github.com/huggingface/lerobot#installation) to install LeRobot.

Install LeRobot with HopeJR dependencies:
```bash
pip install -e ".[hopejr]"
```

## Device Configuration

Before starting calibration and operation, you need to identify the USB ports for each HopeJR component. Run this script to find the USB ports for the arm, hand, glove, and exoskeleton:

```bash
python -m lerobot.find_port
```

This will display the available USB ports and their associated devices. Make note of the port paths (e.g., `/dev/tty.usbmodem58760433331`, `/dev/tty.usbmodem11301`) as you'll need to specify them in the `--robot.port` and `--teleop.port` parameters when recording data, replaying episodes, or running teleoperation scripts.

## Step 1: Calibration

Before performing teleoperation, HopeJR's limbs need to be calibrated. Calibration files will be saved in `~/.cache/huggingface/lerobot/calibration`

### 1.1 Calibrate Hand

```bash
python examples/hope_jr/vis/hand.py
```

When running the calibration script, a calibration GUI will pop up. Finger joints are named as follows:

**Thumb**:
- **CMC**: base joint connecting thumb to hand
- **MCP**: knuckle joint
- **PIP**: first finger joint
- **DIP** : fingertip joint

**Index, Middle, Ring, and Pinky fingers**:
- **Radial flexor**: Moves base of finger towards the thumb
- **Ulnar flexor**: Moves base of finger towards the pinky
- **PIP/DIP**: Flexes the distal and proximal phalanx of the finger

Each one of these will need to be calibrated individually via the GUI.
 Note that ulnar and radial flexors should have ranges of the same size (but with different offsets) in order to get symmetric movement.

<p align="center">
  <img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/lerobot/calibration_gui_1.png"
    alt="Setting boundaries in the hand calibration GUI"
    title="Setting boundaries in the hand calibration GUI"
    width="100%">
  </img>
</p>

Use the calibration interface to set the range boundaries for each joint as shown above.

<p align="center">
  <img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/lerobot/calibration_gui_2.png"
    alt="Saving calibration values"
    title="Saving calibration values"
    width="100%">
  </img>
</p>

Once you have set the appropriate boundaries for all joints, click "Save" to save the calibration values to the motors.

### 1.2 Calibrate Glove

```bash
python examples/hope_jr/vis/glove.py
```

Move each finger through its full range of motion, starting from the thumb.

```
Move thumb through its entire range of motion.
Recording positions. Press ENTER to stop...

-------------------------------------------
NAME      |    MIN |    POS |    MAX
thumb_cmc |   1790 |   1831 |   1853
thumb_mcp |   1497 |   1514 |   1528
thumb_pip |   1466 |   1496 |   1515
thumb_dip |   1463 |   1484 |   1514
```

Continue with each finger:

```
Move middle through its entire range of motion.
Recording positions. Press ENTER to stop...

-------------------------------------------
NAME                 |    MIN |    POS |    MAX
middle_mcp_abduction |   1598 |   1718 |   1820
middle_mcp_flexion   |   1512 |   1658 |   2136
middle_dip           |   1484 |   1500 |   1547
```

Once calibration is complete, the system will save the calibration data and display the current normalized values:

```
Calibration saved to /Users/your_username/.cache/huggingface/lerobot/calibration/teleoperators/homunculus_glove/left.json

----------------------------------
NAME                     |     RAW |    NORM
thumb_cmc                |    1744 |   58.33
thumb_mcp                |    1468 |  100.00
thumb_pip                |    1483 |   50.00
thumb_dip                |    2152 |   78.57
index_mcp_abduction      |    1916 |    3.45
index_mcp_flexion        |    1884 |   66.67
index_dip                |    1705 |   11.11
middle_mcp_abduction     |    1679 |   57.14
middle_mcp_flexion       |    2076 |   90.48
middle_dip               |    1512 |   87.50
ring_mcp_abduction       |    1914 |   46.67
ring_mcp_flexion         |    1866 |   75.00
ring_dip                 |    1994 |   50.00
pinky_mcp_abduction      |    1725 |  60.03
pinky_mcp_flexion        |    1791 |    8.33
pinky_dip                |    1886 |   69.23

time: 2.64ms (379 Hz)
```

### 1.3 Calibrate Arm

```bash
python examples/hope_jr/vis/arm.py
```

This will open a calibration GUI where you can set the range limits for each motor. The arm motions are organized as follows:
- **Shoulder**: pitch, yaw, and roll
- **Elbow**: flex
- **Wrist**: pitch, yaw, and roll

<p align="center">
  <img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/lerobot/calibration_gui_2.png"
    alt="Setting boundaries in the arm calibration GUI"
    title="Setting boundaries in the arm calibration GUI"
    width="100%">
  </img>
</p>

Use the calibration interface to set the range boundaries for each joint. Move each joint through its full range of motion and adjust the minimum and maximum values accordingly. Once you have set the appropriate boundaries for all joints, save the calibration.

### 1.4 Calibrate Exoskeleton

```bash
python examples/hope_jr/vis/exo.py
```

The exoskeleton allows one to control the robot arm. During calibration, you'll be prompted to move all joints through their full range of motion:

```
Move all joints through their entire range of motion.
Recording positions. Press ENTER to stop...

-------------------------------------------
-------------------------------------------
NAME            |    MIN |    POS |    MAX
shoulder_pitch  |    586 |    736 |    895
shoulder_yaw    |   1257 |   1374 |   1390
shoulder_roll   |    449 |   1034 |   2564
elbow_flex      |   3023 |   3117 |   3134
wrist_roll      |   3073 |   3096 |   3147
wrist_yaw       |   2143 |   2171 |   2185
wrist_pitch     |   1975 |   1993 |   2074
Calibration saved to /Users/your_username/.cache/huggingface/lerobot/calibration/teleoperators/homunculus_arm/left.json

----------------------------
NAME               |     RAW |    NORM
shoulder_pitch     |     724 |  -10.68
shoulder_yaw       |    1373 |   74.44
shoulder_roll      |    2528 |   96.60
elbow_flex         |    3117 |   69.37
wrist_roll         |    3097 |  -35.14
wrist_yaw          |    2171 |   33.33
wrist_pitch        |    1993 |  -63.64

time: 2.93ms (341 Hz)
```

## Step 2: Teleoperation

Due to global variable conflicts in the Feetech middleware, teleoperation for arm and hand must run in separate shell sessions:

```bash
# Terminal 1: Left Arm
python examples/hope_jr/teleop/left_arm_teleop.py

# Terminal 2: Right Arm
python examples/hope_jr/teleop/right_arm_teleop.py

# Terminal 3: Left Hand
python examples/hope_jr/teleop/left_hand_teleop.py

# Terminal 4: Right Hand
python examples/hope_jr/teleop/right_hand_teleop.py
```

## Step 3: Record, Replay, Train

```bash
python -m lerobot.teleoperate \
    --robot.type=hope_jr_hand \
    --robot.port=/dev/tty.usbmodem58760432281 \
    --robot.id=right \
    --robot.side=right \
    --teleop.type=homunculus_glove \
    --teleop.port=/dev/tty.usbmodem1201 \
    --teleop.id=right \
    --teleop.side=right \
    --display_data=true --fps=30
```
