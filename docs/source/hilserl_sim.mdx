# ì‹œë®¬ë ˆì´ì…˜ì—ì„œ RL í•™ìŠµ

ì´ ê°€ì´ë“œëŠ” LeRobot í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ì—¬ Human-In-the-Loop (HIL) ê°•í™” í•™ìŠµì„ ìˆ˜í–‰í•  ë•Œ ì‹¤ì œ ë¡œë´‡ì˜ ëŒ€ì•ˆìœ¼ë¡œ `gym_hil` ì‹œë®¬ë ˆì´ì…˜ í™˜ê²½ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

`gym_hil`ì€ Human-In-the-Loop ê°•í™” í•™ìŠµì„ ìœ„í•´ íŠ¹ë³„íˆ ì„¤ê³„ëœ Gymnasium í˜¸í™˜ ì‹œë®¬ë ˆì´ì…˜ í™˜ê²½ì„ ì œê³µí•˜ëŠ” íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ í™˜ê²½ì„ í†µí•´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ì‹¤ì œ ë¡œë´‡ì—ì„œ í•™ìŠµí•˜ê¸° ì „ì— RL ìŠ¤íƒì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ì‹œë®¬ë ˆì´ì…˜ì—ì„œ ì •ì±… í•™ìŠµ

- ê²Œì„íŒ¨ë“œë‚˜ í‚¤ë³´ë“œì™€ ê°™ì€ ì™¸ë¶€ ì¥ì¹˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œë®¬ë ˆì´ì…˜ì—ì„œ ì‹œì—° ìˆ˜ì§‘
- ì •ì±… í•™ìŠµ ì¤‘ ì¸ê°„ ê°œì… ìˆ˜í–‰

í˜„ì¬ ì£¼ìš” í™˜ê²½ì€ íë¸Œë¥¼ ì§‘ëŠ” ê²ƒê³¼ ê°™ì€ ì‘ì—…ì´ ìˆëŠ” MuJoCo ê¸°ë°˜ Franka Panda ë¡œë´‡ ì‹œë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤.

## ì„¤ì¹˜

ë¨¼ì € LeRobot í™˜ê²½ ë‚´ì—ì„œ `gym_hil` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤:

```bash
pip install -e ".[hilserl]"
```

## ë¬´ì—‡ì´ í•„ìš”í•œê°€ìš”?

- ë¡œë´‡ì„ ì œì–´í•˜ê¸° ìœ„í•œ ê²Œì„íŒ¨ë“œ ë˜ëŠ” í‚¤ë³´ë“œ
- Nvidia GPU

## êµ¬ì„±

LeRobotê³¼ í•¨ê»˜ `gym_hil`ì„ ì‚¬ìš©í•˜ë ¤ë©´ êµ¬ì„± íŒŒì¼ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆì œëŠ” [ì—¬ê¸°](https://huggingface.co/datasets/lerobot/config_examples/resolve/main/rl/gym_hil/env_config.json)ì— ì œê³µë©ë‹ˆë‹¤. ì£¼ìš” êµ¬ì„± ì„¹ì…˜ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

### í™˜ê²½ ìœ í˜• ë° ì‘ì—…

```json
{
  "env": {
    "type": "gym_manipulator",
    "name": "gym_hil",
    "task": "PandaPickCubeGamepad-v0",
    "fps": 10
  },
  "device": "cuda"
}
```

ì‚¬ìš© ê°€ëŠ¥í•œ ì‘ì—…:

- `PandaPickCubeBase-v0`: ê¸°ë³¸ í™˜ê²½
- `PandaPickCubeGamepad-v0`: ê²Œì„íŒ¨ë“œ ì œì–´ ì‚¬ìš©
- `PandaPickCubeKeyboard-v0`: í‚¤ë³´ë“œ ì œì–´ ì‚¬ìš©

### í”„ë¡œì„¸ì„œ êµ¬ì„±

```json
{
  "env": {
    "processor": {
      "control_mode": "gamepad",
      "gripper": {
        "use_gripper": true,
        "gripper_penalty": -0.02
      },
      "reset": {
        "control_time_s": 15.0,
        "fixed_reset_joint_positions": [
          0.0, 0.195, 0.0, -2.43, 0.0, 2.62, 0.785
        ]
      },
      "inverse_kinematics": {
        "end_effector_step_sizes": {
          "x": 0.025,
          "y": 0.025,
          "z": 0.025
        }
      }
    }
  }
}
```

ì¤‘ìš”í•œ ë§¤ê°œë³€ìˆ˜:

- `gripper.gripper_penalty`: ê³¼ë„í•œ ê·¸ë¦¬í¼ ì›€ì§ì„ì— ëŒ€í•œ í˜ë„í‹°
- `gripper.use_gripper`: ê·¸ë¦¬í¼ ì œì–´ í™œì„±í™” ì—¬ë¶€
- `inverse_kinematics.end_effector_step_sizes`: ì—”ë“œ ì´í™í„°ì˜ x, y, z ì¶• ìŠ¤í… í¬ê¸°
- `control_mode`: ê²Œì„íŒ¨ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `"gamepad"`ë¡œ ì„¤ì •

## LeRobotì˜ HIL RLê³¼ í•¨ê»˜ ì‹¤í–‰

### ê¸°ë³¸ ì‚¬ìš©ë²•

í™˜ê²½ì„ ì‹¤í–‰í•˜ë ¤ë©´ modeë¥¼ nullë¡œ ì„¤ì •í•˜ì„¸ìš”:

```bash
python -m lerobot.rl.gym_manipulator --config_path path/to/gym_hil_env.json
```

### ë°ì´í„°ì…‹ ê¸°ë¡

ë°ì´í„°ì…‹ì„ ìˆ˜ì§‘í•˜ë ¤ë©´ modeë¥¼ `record`ë¡œ ì„¤ì •í•˜ê³  repo_idì™€ ê¸°ë¡í•  ì—í”¼ì†Œë“œ ìˆ˜ë¥¼ ì •ì˜í•˜ì„¸ìš”:

```json
{
  "env": {
    "type": "gym_manipulator",
    "name": "gym_hil",
    "task": "PandaPickCubeGamepad-v0"
  },
  "dataset": {
    "repo_id": "username/sim_dataset",
    "root": null,
    "task": "pick_cube",
    "num_episodes_to_record": 10,
    "replay_episode": null,
    "push_to_hub": true
  },
  "mode": "record"
}
```

```bash
python -m lerobot.rl.gym_manipulator --config_path path/to/gym_hil_env.json
```

### ì •ì±… í•™ìŠµ

ì •ì±…ì„ í•™ìŠµí•˜ë ¤ë©´ [ì—¬ê¸°](https://huggingface.co/datasets/lerobot/config_examples/resolve/main/rl/gym_hil/train_config.json)ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ êµ¬ì„± ì˜ˆì œë¥¼ í™•ì¸í•˜ê³  actorì™€ learner ì„œë²„ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”:

```bash
python -m lerobot.rl.actor --config_path path/to/train_gym_hil_env.json
```

ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ learner ì„œë²„ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”:

```bash
python -m lerobot.rl.learner --config_path path/to/train_gym_hil_env.json
```

ì‹œë®¬ë ˆì´ì…˜ í™˜ê²½ì€ ì‹¤ì œ ë¡œë´‡ì— ë°°í¬í•˜ê¸° ì „ì— Human-In-the-Loop ê°•í™” í•™ìŠµ êµ¬ì„± ìš”ì†Œë¥¼ ê°œë°œí•˜ê³  í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” ì•ˆì „í•˜ê³  ë°˜ë³µ ê°€ëŠ¥í•œ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

ì¶•í•˜í•©ë‹ˆë‹¤ ğŸ‰, ì´ íŠœí† ë¦¬ì–¼ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!

> [!TIP]
> ì§ˆë¬¸ì´ ìˆê±°ë‚˜ ë„ì›€ì´ í•„ìš”í•˜ë©´ [Discord](https://discord.com/invite/s3KuuzsPFb)ì—ì„œ ì—°ë½í•˜ì„¸ìš”.

ë…¼ë¬¸ ì¸ìš©:

```
@article{luo2024precise,
  title={Precise and Dexterous Robotic Manipulation via Human-in-the-Loop Reinforcement Learning},
  author={Luo, Jianlan and Xu, Charles and Wu, Jeffrey and Levine, Sergey},
  journal={arXiv preprint arXiv:2410.21845},
  year={2024}
}
```
