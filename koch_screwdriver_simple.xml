<mujoco model="koch_screwdriver_follower_simple">
  <compiler angle="radian"/>
  
  <option timestep="0.002" gravity="0 0 -9.81">
    <flag contact="enable" energy="enable"/>
  </option>

  <default>
    <joint damping="0.1"/>
    <geom friction="1 0.5 0.001" rgba="0.7 0.7 0.7 1"/>
  </default>

  <asset>
    <material name="robot_gray" rgba="0.7 0.7 0.7 1"/>
    <material name="robot_black" rgba="0.2 0.2 0.2 1"/>
    <material name="tool_blue" rgba="0.3 0.3 0.8 1"/>
    <material name="wood" rgba="0.6 0.4 0.2 1"/>
    <material name="metal" rgba="0.8 0.8 0.8 1"/>
  </asset>

  <worldbody>
    <!-- Fixed base -->
    <body name="base" pos="0 0 0">
      <geom name="base_cylinder" type="cylinder" size="0.08 0.03" material="robot_black"/>
      <geom name="base_top" type="cylinder" size="0.06 0.02" pos="0 0 0.05" material="robot_gray"/>
      
      <!-- Joint 1: shoulder_pan (Z-axis rotation) -->
      <body name="shoulder_pan_link" pos="0 0 0.07">
        <joint name="shoulder_pan" type="hinge" axis="0 0 1" range="-3.14159 3.14159"/>
        <geom name="shoulder_base" type="cylinder" size="0.04 0.03" material="robot_gray"/>
        
        <!-- Joint 2: shoulder_lift (Y-axis rotation) -->
        <body name="shoulder_lift_link" pos="0 0 0.05">
          <joint name="shoulder_lift" type="hinge" axis="0 1 0" range="-1.57 1.57"/>
          <geom name="shoulder_joint" type="sphere" size="0.03" material="robot_black"/>
          <geom name="upper_arm" type="capsule" fromto="0 0 0 0.15 0 0" size="0.025" material="robot_gray"/>
          
          <!-- Joint 3: elbow_flex (Y-axis rotation) -->
          <body name="elbow_flex_link" pos="0.15 0 0">
            <joint name="elbow_flex" type="hinge" axis="0 1 0" range="-1.57 1.57" damping="0.05"/>
            <geom name="elbow_joint" type="sphere" size="0.025" material="robot_black"/>
            <geom name="forearm" type="capsule" fromto="0 0 0 0.13 0 0" size="0.02" material="robot_gray"/>
            
            <!-- Joint 4: wrist_flex (Y-axis rotation) -->
            <body name="wrist_flex_link" pos="0.13 0 0">
              <joint name="wrist_flex" type="hinge" axis="0 1 0" range="-1.57 1.57" damping="0.05"/>
              <geom name="wrist_joint" type="sphere" size="0.02" material="robot_black"/>
              
              <!-- Joint 5: wrist_roll (X-axis rotation) -->
              <body name="wrist_roll_link" pos="0.04 0 0">
                <joint name="wrist_roll" type="hinge" axis="1 0 0" range="-3.14159 3.14159" damping="0.05"/>
                <geom name="wrist_mount" type="cylinder" size="0.015 0.02" pos="0 0 0" material="robot_gray"/>
                
                <!-- Joint 6: screwdriver (X-axis continuous rotation) -->
                <body name="screwdriver_mount" pos="0.03 0 0">
                  <joint name="screwdriver" type="hinge" axis="1 0 0" damping="0.01"/>
                  <!-- Screwdriver handle -->
                  <geom name="screwdriver_handle" type="cylinder" size="0.012 0.04" 
                        pos="0 0 0" material="tool_blue" euler="0 1.5708 0"/>
                  <!-- Screwdriver shaft -->
                  <geom name="screwdriver_shaft" type="cylinder" size="0.003 0.05" 
                        pos="0.05 0 0" material="metal" euler="0 1.5708 0"/>
                  <!-- Screwdriver tip (Phillips head approximation) -->
                  <geom name="screwdriver_tip" type="box" size="0.002 0.002 0.005" 
                        pos="0.1 0 0" material="metal" friction="2.0 0.005 0.0001"/>
                </body>
              </body>
            </body>
          </body>
        </body>
      </body>
    </body>
    
    <!-- Work table -->
    <body name="table" pos="0.3 0 -0.05">
      <geom name="table_top" type="box" size="0.3 0.3 0.02" rgba="0.5 0.3 0.1 1"/>
    </body>
    
    <!-- Workpiece with screw holes -->
    <body name="workpiece" pos="0.35 0 0.02">
      <freejoint/>
      <geom name="wood_block" type="box" size="0.08 0.08 0.03" material="wood" mass="0.2"/>
      
      <!-- Screw hole 1 -->
      <body name="screw_hole_1" pos="0.03 0.03 0">
        <geom name="hole_1" type="cylinder" size="0.003 0.035" rgba="0.1 0.1 0.1 1" contype="0" conaffinity="0"/>
      </body>
      
      <!-- Screw hole 2 -->
      <body name="screw_hole_2" pos="-0.03 0.03 0">
        <geom name="hole_2" type="cylinder" size="0.003 0.035" rgba="0.1 0.1 0.1 1" contype="0" conaffinity="0"/>
      </body>
      
      <!-- Screw hole 3 -->
      <body name="screw_hole_3" pos="0.03 -0.03 0">
        <geom name="hole_3" type="cylinder" size="0.003 0.035" rgba="0.1 0.1 0.1 1" contype="0" conaffinity="0"/>
      </body>
      
      <!-- Screw hole 4 -->
      <body name="screw_hole_4" pos="-0.03 -0.03 0">
        <geom name="hole_4" type="cylinder" size="0.003 0.035" rgba="0.1 0.1 0.1 1" contype="0" conaffinity="0"/>
      </body>
    </body>
    
    <!-- Screws to insert -->
    <body name="screw_1" pos="0.25 0.1 0.05">
      <freejoint/>
      <geom name="screw_head_1" type="cylinder" size="0.005 0.002" material="metal" mass="0.01"/>
      <geom name="screw_body_1" type="cylinder" size="0.0025 0.02" pos="0 0 -0.02" material="metal"/>
    </body>
  </worldbody>

  <actuator>
    <!-- Position control for joints 1-5 -->
    <position name="shoulder_pan_actuator" joint="shoulder_pan" kp="100" kd="10" ctrlrange="-3.14159 3.14159"/>
    <position name="shoulder_lift_actuator" joint="shoulder_lift" kp="100" kd="10" ctrlrange="-1.57 1.57"/>
    <position name="elbow_flex_actuator" joint="elbow_flex" kp="50" kd="5" ctrlrange="-1.57 1.57"/>
    <position name="wrist_flex_actuator" joint="wrist_flex" kp="50" kd="5" ctrlrange="-1.57 1.57"/>
    <position name="wrist_roll_actuator" joint="wrist_roll" kp="50" kd="5" ctrlrange="-3.14159 3.14159"/>
    
    <!-- Velocity control for screwdriver -->
    <velocity name="screwdriver_actuator" joint="screwdriver" kv="10" ctrlrange="-10 10"/>
  </actuator>

  <sensor>
    <!-- Joint position sensors -->
    <jointpos name="shoulder_pan_pos" joint="shoulder_pan"/>
    <jointpos name="shoulder_lift_pos" joint="shoulder_lift"/>
    <jointpos name="elbow_flex_pos" joint="elbow_flex"/>
    <jointpos name="wrist_flex_pos" joint="wrist_flex"/>
    <jointpos name="wrist_roll_pos" joint="wrist_roll"/>
    
    <!-- Joint velocity sensors -->
    <jointvel name="shoulder_pan_vel" joint="shoulder_pan"/>
    <jointvel name="shoulder_lift_vel" joint="shoulder_lift"/>
    <jointvel name="elbow_flex_vel" joint="elbow_flex"/>
    <jointvel name="wrist_flex_vel" joint="wrist_flex"/>
    <jointvel name="wrist_roll_vel" joint="wrist_roll"/>
    <jointvel name="screwdriver_vel" joint="screwdriver"/>
    
    <!-- Torque sensors -->
    <torque name="screwdriver_torque" joint="screwdriver"/>
    
    <!-- Touch sensors for screwdriver tip -->
    <touch name="screwdriver_touch" site="screwdriver_tip_site"/>
  </sensor>
  
  <site>
    <!-- Site at screwdriver tip for touch sensing -->
    <site name="screwdriver_tip_site" pos="0.1 0 0" size="0.003" rgba="1 0 0 0.5" group="1"/>
  </site>
  
  <!-- Cameras -->
  <camera name="side_camera" pos="0.7 0.7 0.5" xyaxes="-1 -1 0 0 0 1" fovy="45"/>
  <camera name="top_camera" pos="0.35 0 0.8" xyaxes="1 0 0 0 1 0" fovy="45"/>
  <camera name="wrist_camera" pos="0.05 0 0.02" xyaxes="0 -1 0 1 0 0" fovy="60" mode="fixed" bodyid="5"/>
</mujoco> 