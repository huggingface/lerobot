# LeKiwi Flask 遥操作服务

这是一个基于Flask的网页遥操作界面，用于控制LeKiwi机器人和SO100机械臂。

## 功能特性

- 🌐 网页界面：现代化的响应式Web界面
- 🎮 多种控制方式：键盘控制 + 鼠标/触摸控制
- 📹 实时视频流：显示机器人摄像头画面
- ⚡ 速度控制：三级速度调节（慢速/中速/快速）
- 🔄 实时状态：显示机器人连接状态和运动参数
- 📱 移动端支持：支持触摸控制，适配移动设备

## 安装依赖

```bash
# 安装Flask和相关依赖
pip install flask flask-cors

# 确保已安装LeRobot
pip install -e .
```

## 使用方法

### 1. 启动LeKiwi主机

首先需要在LeKiwi机器人上启动主机服务：

```bash
# 在LeKiwi机器人上运行
python -m lerobot.robots.lekiwi.lekiwi_host --robot.id=my_awesome_kiwi
```

### 2. 启动Flask服务

```bash
# 在控制端运行
cd examples/lekiwi
python flask_teleop_server.py
```

### 3. 访问网页界面

打开浏览器访问：`http://localhost:5000`

### 4. 连接设备

1. 在网页界面中输入连接参数：
   - **机器人IP地址**：LeKiwi机器人的IP地址（默认：192.168.101.33）
   - **机械臂端口**：SO100机械臂的串口端口（默认：/dev/ttyACM0）

2. 点击"连接"按钮

### 5. 开始控制

连接成功后，可以使用以下方式控制机器人：

#### 键盘控制
- **W** - 前进
- **S** - 后退  
- **A** - 左转
- **D** - 右转
- **Z** - 左旋转
- **X** - 右旋转
- **R** - 加速
- **F** - 减速

#### 鼠标/触摸控制
- 点击界面上的按钮进行控制
- 支持触摸设备操作

## 界面说明

### 左侧控制面板
- **连接状态**：显示机器人和机械臂的连接状态
- **速度控制**：调节机器人运动速度
- **方向控制**：控制机器人移动方向
- **旋转控制**：控制机器人旋转
- **状态显示**：实时显示机器人运动参数

### 右侧视频显示
- **实时视频流**：显示机器人摄像头画面
- **FPS显示**：显示视频帧率

## 配置说明

### 机器人配置
- `remote_ip`：LeKiwi机器人的IP地址
- `port_zmq_cmd`：命令端口（默认：5555）
- `port_zmq_observations`：观察端口（默认：5556）

### 机械臂配置
- `port`：SO100机械臂的串口端口
- 支持自动校准和配置

### 速度等级
- **慢速**：xy=0.1 m/s, theta=30 deg/s
- **中速**：xy=0.2 m/s, theta=60 deg/s  
- **快速**：xy=0.3 m/s, theta=90 deg/s

## 故障排除

### 连接问题
1. **机器人连接失败**
   - 检查LeKiwi主机是否正在运行
   - 确认IP地址是否正确
   - 检查网络连接

2. **机械臂连接失败**
   - 检查串口端口是否正确
   - 确认机械臂已正确连接
   - 检查串口权限

### 视频流问题
1. **视频不显示**
   - 检查摄像头是否正常工作
   - 确认摄像头配置正确
   - 检查网络带宽

### 控制问题
1. **按键无响应**
   - 确认已成功连接
   - 检查浏览器焦点
   - 查看控制台错误信息

## 开发说明

### 项目结构
```
examples/lekiwi/
├── flask_teleop_server.py    # Flask服务器
├── templates/
│   └── lekiwi_control.html   # 前端界面
└── README_flask_teleop.md    # 说明文档
```

### 主要组件
- **Flask服务器**：处理HTTP请求和WebSocket通信
- **视频流线程**：获取和编码视频帧
- **控制线程**：处理用户输入和机器人控制
- **前端界面**：提供用户交互界面

### 扩展功能
- 支持多摄像头切换
- 可添加机械臂关节角度显示
- 支持录制和回放功能
- 可集成更多传感器数据

## 安全注意事项

1. **网络安全**：确保在安全的网络环境中使用
2. **权限控制**：限制访问权限，避免未授权访问
3. **紧急停止**：确保有紧急停止机制
4. **速度限制**：合理设置速度限制，确保安全

## 许可证

本项目遵循LeRobot的许可证协议。 